<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuMatch Inmobiliario - Propiedades Premium</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #030508;
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            position: relative;
            line-height: 1.6;
        }
        
        /* Fondo profesional con gradientes sutiles */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #030508 0%, #0a0a15 30%, #050812 70%, #020406 100%);
            z-index: -2;
        }
        
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse at 25% 85%, rgba(90, 120, 180, 0.04) 0%, transparent 60%),
                radial-gradient(ellipse at 75% 15%, rgba(180, 90, 140, 0.03) 0%, transparent 55%);
            z-index: -1;
            animation: subtleFlow 60s linear infinite;
        }
        
        @keyframes subtleFlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        /* Layout principal */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header redise√±ado */
        .main-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 32px;
            padding: 40px 60px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 20px 80px rgba(0, 0, 0, 0.3),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .brand-section {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .brand-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF1493 50%, #8A2BE2 100%);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            box-shadow: 0 8px 32px rgba(255, 107, 107, 0.2);
        }

        .brand-text h1 {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FF6B6B, #FF1493, #8A2BE2);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }

        .brand-text p {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        /* Indicador UF redise√±ado */
        .uf-display {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.05) 100%);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 24px;
            padding: 24px 32px;
            text-align: center;
            min-width: 200px;
            box-shadow: 0 12px 48px rgba(255, 215, 0, 0.1);
        }

        .uf-label {
            font-size: 0.9rem;
            color: rgba(255, 215, 0, 0.8);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .uf-value {
            font-size: 1.4rem;
            color: #FFD700;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .uf-date {
            font-size: 0.75rem;
            color: rgba(255, 215, 0, 0.6);
        }

        /* Navegaci√≥n de acciones */
        .action-nav {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 40px;
        }

        .action-btn {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.8), rgba(123, 97, 255, 0.8));
            border: none;
            border-radius: 20px;
            padding: 16px 32px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(255, 107, 107, 0.3);
            background: linear-gradient(135deg, rgba(255, 107, 107, 1), rgba(123, 97, 255, 1));
        }

        /* Sistema de filtros moderno */
        .filters-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            backdrop-filter: blur(50px);
            -webkit-backdrop-filter: blur(50px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 32px;
            padding: 48px;
            margin-bottom: 48px;
            box-shadow: 
                0 24px 96px rgba(0, 0, 0, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
        }

        .filters-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .filters-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #FF6B6B, #FF1493);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .filters-subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .filter-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 32px;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
        }

        .filter-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 107, 107, 0.2);
        }

        .filter-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .filter-icon {
            font-size: 1.2rem;
        }

        .filter-input, .filter-select {
            width: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.2) 100%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 16px 20px;
            color: white;
            font-size: 1rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
            outline: none;
        }

        .filter-input:focus, .filter-select:focus {
            border-color: rgba(255, 107, 107, 0.5);
            box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.1);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.3) 100%);
        }

        .filter-select option {
            background: #1a1a2e;
            color: white;
            padding: 12px;
        }

        /* Toggle switches modernos */
        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 12px;
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 8px 16px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.8), rgba(123, 97, 255, 0.8));
            color: white;
            border-color: rgba(255, 107, 107, 0.3);
        }

        /* Sistema de tarjetas premium */
        .properties-section {
            margin-bottom: 60px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: white;
        }

        .properties-count {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(123, 97, 255, 0.2));
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 16px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
        }

        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
            gap: 32px;
            padding: 20px 0;
        }

        .property-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 32px;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            position: relative;
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
            box-shadow: 
                0 16px 64px rgba(0, 0, 0, 0.3),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
        }

        .property-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 
                0 32px 128px rgba(0, 0, 0, 0.4),
                0 1px 0 rgba(255, 255, 255, 0.2) inset;
            border-color: rgba(255, 107, 107, 0.3);
        }

        .card-header {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF1493 50%, #8A2BE2 100%);
            padding: 32px;
            position: relative;
            overflow: hidden;
        }

        .property-code {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 8px 16px;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .property-code:hover {
            background: rgba(0, 0, 0, 0.7);
            transform: scale(1.05);
        }

        .property-price {
            font-size: 2.8rem;
            font-weight: 800;
            color: white;
            text-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .property-price:hover {
            transform: scale(1.05);
        }

        .price-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }

        .card-content {
            padding: 32px;
        }

        .property-info {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-label {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        .info-value {
            font-size: 1rem;
            color: white;
            font-weight: 600;
        }

        .bono-badge {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.9), rgba(255, 165, 0, 0.9));
            color: #1a1a2e;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 800;
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 6px 24px rgba(255, 215, 0, 0.3);
        }

        .rentabilidad-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 16px 20px;
            border-radius: 18px;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .rentabilidad-good {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(16, 185, 129, 0.9));
            color: white;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .rentabilidad-average {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.9), rgba(245, 158, 11, 0.9));
            color: #1a1a2e;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .rentabilidad-low {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));
            color: white;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .rentabilidad-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .rentabilidad-value {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
        }

        .card-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-primary {
            flex: 1;
            background: linear-gradient(135deg, #FF6B6B, #FF1493);
            border: none;
            border-radius: 16px;
            padding: 16px 24px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(255, 107, 107, 0.4);
        }

        /* Modal moderno */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            backdrop-filter: blur(50px);
            -webkit-backdrop-filter: blur(50px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 32px;
            padding: 40px;
            max-width: 800px;
            max-height: 90vh;
            width: 100%;
            overflow-y: auto;
            position: relative;
            box-shadow: 
                0 32px 128px rgba(0, 0, 0, 0.5),
                0 1px 0 rgba(255, 255, 255, 0.2) inset;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 107, 107, 0.8);
            transform: scale(1.1);
        }

        /* Estados de carga y vac√≠o */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            text-align: center;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 107, 107, 0.3);
            border-top: 4px solid #FF6B6B;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 24px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 24px;
            opacity: 0.5;
        }

        /* Animaciones */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .app-container {
                padding: 16px;
            }

            .header-content {
                flex-direction: column;
                gap: 24px;
                text-align: center;
            }

            .brand-text h1 {
                font-size: 2.2rem;
            }

            .filters-section {
                padding: 32px 24px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .properties-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .property-card {
                border-radius: 24px;
            }

            .card-header {
                padding: 24px;
            }

            .property-price {
                font-size: 2.2rem;
            }

            .modal-content {
                padding: 24px;
                margin: 20px;
                border-radius: 24px;
            }
        }

        @media (max-width: 480px) {
            .brand-text h1 {
                font-size: 1.8rem;
            }

            .filters-section {
                padding: 24px 20px;
            }

            .filter-card {
                padding: 24px;
            }

            .property-price {
                font-size: 1.8rem;
            }
        }

        /* Utilidades */
        .text-center { text-align: center; }
        .hidden { display: none !important; }
        .visible { display: block !important; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .gap-4 { gap: 16px; }
        .mb-4 { margin-bottom: 16px; }
        .mt-4 { margin-top: 16px; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header principal -->
        <header class="main-header" style="animation: fadeInDown 0.8s ease;">
            <div class="header-content">
                <div class="brand-section">
                    <div class="brand-icon">üè†</div>
                    <div class="brand-text">
                        <h1>TUMATCH</h1>
                        <p>Inmobiliario Premium</p>
                    </div>
                </div>
                <div class="uf-display">
                    <div class="uf-label">Valor UF Hoy</div>
                    <div class="uf-value" id="uf-value">Cargando...</div>
                    <div class="uf-date" id="uf-date"></div>
                </div>
            </div>
        </header>

        <!-- Navegaci√≥n de acciones -->
        <nav class="action-nav">
            <button id="condicionesBtn" class="action-btn" onclick="showCondicionesModal()">
                üìã T√©rminos y Condiciones
            </button>
        </nav>

        <!-- Indicador de carga -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <h3>Cargando propiedades premium...</h3>
            <p>Preparando la mejor selecci√≥n para ti</p>
        </div>

        <!-- Contenido principal -->
        <main id="content" class="hidden">
            <!-- Secci√≥n de filtros -->
            <section class="filters-section">
                <div class="filters-header">
                    <h2 class="filters-title">üîç Filtros Inteligentes</h2>
                    <p class="filters-subtitle">Encuentra tu propiedad ideal con nuestro sistema avanzado de b√∫squeda</p>
                </div>

                <div class="filters-grid">
                    <div class="filter-card">
                        <label class="filter-label">
                            <span class="filter-icon">üí∞</span>
                            Rango de Bono
                            <div class="filter-toggle">
                                <button id="toggleBonoFilter" class="toggle-btn active" onclick="toggleBonoFilterType()">
                                    üìä Rangos Din√°micos
                                </button>
                            </div>
                        </label>
                        <div id="bonoRangeFilter">
                            <select id="filterBono" class="filter-select">
                                <option value="">Cualquier bono</option>
                            </select>
                        </div>
                        <div id="bonoManualFilter" style="display: none;">
                            <div style="display: flex; gap: 16px;">
                                <input type="text" id="filterBonoMin" class="filter-input" placeholder="M√≠nimo">
                                <input type="text" id="filterBonoMax" class="filter-input" placeholder="M√°ximo">
                            </div>
                        </div>
                    </div>

                    <div class="filter-card">
                        <label class="filter-label">
                            <span class="filter-icon">üè†</span>
                            Precio en UF
                            <div class="filter-toggle">
                                <button id="togglePrecioFilter" class="toggle-btn active" onclick="togglePrecioFilterType()">
                                    üìä Rangos Din√°micos
                                </button>
                            </div>
                        </label>
                        <div id="precioRangeFilter">
                            <select id="filterPrecio" class="filter-select">
                                <option value="">Cualquier precio</option>
                            </select>
                        </div>
                        <div id="precioManualFilter" style="display: none;">
                            <div style="display: flex; gap: 16px;">
                                <input type="text" id="filterPrecioMin" class="filter-input" placeholder="M√≠n UF">
                                <input type="text" id="filterPrecioMax" class="filter-input" placeholder="M√°x UF">
                            </div>
                        </div>
                    </div>

                    <div class="filter-card">
                        <label class="filter-label">
                            <span class="filter-icon">üìç</span>
                            Comuna
                        </label>
                        <select id="filterUbicacion" class="filter-select">
                            <option value="">Todas las comunas</option>
                        </select>
                    </div>

                    <div class="filter-card">
                        <label class="filter-label">
                            <span class="filter-icon">üè¢</span>
                            Tipolog√≠a
                        </label>
                        <select id="filterTipologia" class="filter-select">
                            <option value="">Todas las tipolog√≠as</option>
                        </select>
                    </div>
                </div>

                <div class="text-center">
                    <button class="action-btn" onclick="clearAllFilters()">
                        üîÑ Limpiar Filtros
                    </button>
                </div>
            </section>

            <!-- Secci√≥n de propiedades -->
            <section class="properties-section">
                <div class="section-header">
                    <h2 class="section-title">Propiedades Disponibles</h2>
                    <div class="properties-count" id="properties-count">
                        0 propiedades
                    </div>
                </div>
                <div id="properties-grid" class="properties-grid"></div>
            </section>
        </main>

        <!-- Modal de detalles de propiedad -->
        <div id="propertyModal" class="modal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeModal()">&times;</button>
                <div id="propertyDetails"></div>
            </div>
        </div>

        <!-- Modal de condiciones -->
        <div id="condicionesModal" class="modal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeCondicionesModal()">&times;</button>
                <div id="condicionesContent">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Cargando t√©rminos y condiciones...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        const SPREADSHEET_ID = '1iF8PuF84cUNPZ3GM50guWsLwwp-slUZNbP0MWtaEPFM';
        const BONOS_GID = '725527455';
        const CONDICIONES_GID = '711460472';
        
        let propsData = [];
        let bonosData = [];
        let filteredProperties = [];
        let valorUF = 37643.59;
        
        // Variables para filtros
        let isBonoManualMode = false;
        let isPrecioManualMode = false;
        
        // Variable para condiciones
        let conditionsAccepted = localStorage.getItem('conditionsAccepted') === 'true';

        // Funciones principales
        async function loadSheetData() {
            try {
                console.log('üöÄ Iniciando carga de datos desde Google Sheets...');
                
                const propsUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=0`;
                const bonosUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${BONOS_GID}`;
                
                console.log('üì° Cargando datos de propiedades...');
                const propsResponse = await fetch(propsUrl);
                
                if (!propsResponse.ok) {
                    throw new Error(`Error cargando propiedades: ${propsResponse.status}`);
                }
                
                const propsText = await propsResponse.text();
                console.log('üì° Cargando datos de bonos...');
                
                const bonosResponse = await fetch(bonosUrl);
                if (!bonosResponse.ok) {
                    throw new Error(`Error cargando bonos: ${bonosResponse.status}`);
                }
                
                const bonosText = await bonosResponse.text();
                
                return {
                    propsData: propsText,
                    bonosData: bonosText
                };
                
            } catch (error) {
                console.error('‚ùå Error cargando datos:', error);
                throw error;
            }
        }

        async function obtenerValorUF() {
            try {
                console.log('üí∞ Obteniendo valor UF actual...');
                const response = await fetch('https://mindicador.cl/api/uf');
                
                if (!response.ok) {
                    throw new Error('Error al obtener UF');
                }
                
                const data = await response.json();
                const valorActual = data.serie[0].valor;
                const fechaActual = new Date(data.serie[0].fecha).toLocaleDateString('es-CL');
                
                valorUF = valorActual;
                
                document.getElementById('uf-value').textContent = `$${valorActual.toLocaleString('es-CL')}`;
                document.getElementById('uf-date').textContent = fechaActual;
                
                console.log(`‚úÖ Valor UF actualizado: $${valorActual.toLocaleString('es-CL')}`);
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Error obteniendo UF, usando valor por defecto:', error);
                document.getElementById('uf-value').textContent = `$${valorUF.toLocaleString('es-CL')}`;
                document.getElementById('uf-date').textContent = 'Valor de referencia';
            }
        }

        function parseCSVData() {
            try {
                console.log('üîÑ Procesando datos CSV...');
                
                // Procesar datos de bonos
                const bonosLines = bonosData.split('\n');
                const bonosMap = new Map();
                
                for (let i = 1; i < bonosLines.length; i++) {
                    const row = parseCSVRow(bonosLines[i]);
                    if (row.length < 2) continue;
                    
                    const codigo = row[0]?.toString().trim();
                    const precio = parseFloat(row[1]?.toString().replace(/[^0-9.-]/g, '')) || 0;
                    const bono = parseFloat(row[4]?.toString().replace(/[^0-9.-]/g, '')) || 0;
                    const orden = parseFloat(row[6]?.toString().replace(/[^0-9.-]/g, '')) || 0;
                    
                    if (codigo && codigo.trim()) {
                        bonosMap.set(codigo.trim(), { precio, bono, orden });
                    }
                }
                
                console.log(`üìä Procesados ${bonosMap.size} bonos`);
                
                // Procesar propiedades
                const propsLines = propsData.split('\n');
                const properties = [];
                const columnNames = {
                    'A': 'OP', 'B': 'CONDOMINIO', 'C': 'DIRECCI√ìN', 'D': 'COMUNA', 'E': 'DP',
                    'F': 'REGI√ìN', 'G': 'TIPOLOG√çA', 'H': 'DORMITORIOS', 'I': 'BA√ëOS',
                    'J': 'ESTACIONAMIENTOS', 'K': 'BODEGAS', 'L': 'M¬≤ √öTILES', 'M': 'M¬≤ TERRAZA',
                    'N': 'M¬≤ TOTALES', 'O': 'PISO', 'P': 'ORIENTACI√ìN', 'Q': 'VISTA',
                    'R': 'ENTREGA', 'S': 'CANON ARRIENDO', 'T': 'GASTOS COMUNES',
                    'U': 'CONTRIBUCIONES', 'V': 'SEGUROS', 'W': 'OTROS GASTOS',
                    'X': 'GASTOS TOTALES', 'Y': 'FLUJO LIBRE', 'Z': 'VENDEDOR',
                    'AA': 'COMISI√ìN VENDEDOR', 'AB': 'COMISI√ìN CLIENTE', 'AC': 'PIE M√çNIMO UF',
                    'AD': 'PIE M√çNIMO %', 'AE': 'PRECIO LISTA UF', 'AF': 'PRECIO LISTA CLP',
                    'AG': 'COMISI√ìN VENTA UF', 'AH': 'COMISI√ìN VENTA CLP', 'AI': 'ARRIENDO BRUTO ANUAL',
                    'AJ': 'RENTABILIDAD BRUTA (ANUAL)', 'AK': 'LINK PUBLICACI√ìN'
                };
                
                for (let i = 1; i < propsLines.length; i++) {
                    const row = parseCSVRow(propsLines[i]);
                    if (row.length < 2) continue;
                    
                    const codigo = row[0]?.toString().trim();
                    if (!codigo) continue;
                    
                    const bonoInfo = bonosMap.get(codigo) || { precio: 0, bono: 0, orden: 0 };
                    const precioFinal = bonoInfo.precio || 0;
                    
                    // Filtrar propiedades con precio 0
                    if (precioFinal <= 0) {
                        console.log(`‚è≠Ô∏è Propiedad ${codigo} excluida: precio 0 UF`);
                        continue;
                    }
                    
                    const property = {
                        id: codigo,
                        codigo: codigo,
                        precio: precioFinal,
                        bono: bonoInfo.bono,
                        ordenBono: bonoInfo.orden,
                        allData: {}
                    };
                    
                    // Agregar todos los datos de columnas
                    const excludedColumns = [32, 33]; // AG y AH (comisiones del vendedor)
                    for (let colIndex = 0; colIndex < row.length; colIndex++) {
                        if (!excludedColumns.includes(colIndex) && row[colIndex]) {
                            let columnLetter;
                            if (colIndex < 26) {
                                columnLetter = String.fromCharCode(65 + colIndex);
                            } else {
                                const firstLetter = String.fromCharCode(65 + Math.floor(colIndex / 26) - 1);
                                const secondLetter = String.fromCharCode(65 + (colIndex % 26));
                                columnLetter = firstLetter + secondLetter;
                            }
                            property.allData[columnLetter] = row[colIndex];
                        }
                    }
                    
                    // Calcular rentabilidad autom√°tica si no existe
                    if (!property.allData.AJ || parseFloat(property.allData.AJ) <= 0) {
                        const rentabilidadCalculada = calcularRentabilidadAutomatica(property);
                        if (rentabilidadCalculada) {
                            property.allData.AJ = rentabilidadCalculada.toFixed(2);
                        }
                    }
                    
                    properties.push(property);
                }
                
                // Ordenar por orden de bono
                properties.sort((a, b) => (b.ordenBono || 0) - (a.ordenBono || 0));
                
                console.log(`‚úÖ Procesadas ${properties.length} propiedades v√°lidas`);
                return properties;
                
            } catch (error) {
                console.error('‚ùå Error procesando datos CSV:', error);
                return [];
            }
        }

        function calcularRentabilidadAutomatica(property) {
            try {
                const arriendoBrutoAnual = property.allData?.AI;
                const canonArriendo = property.allData?.S;
                const precioFinalUF = property.allData?.AE || property.precio;
                
                let arriendoAnual = 0;
                
                if (arriendoBrutoAnual && parseFloat(arriendoBrutoAnual) > 0) {
                    arriendoAnual = parseFloat(arriendoBrutoAnual);
                } else if (canonArriendo && parseFloat(canonArriendo) > 0) {
                    arriendoAnual = parseFloat(canonArriendo) * 12;
                }
                
                if (!arriendoAnual || !precioFinalUF || arriendoAnual <= 0) {
                    return null;
                }
                
                const precioNumerico = parseFloat(precioFinalUF.toString().replace(/[^0-9.-]/g, ''));
                if (isNaN(precioNumerico) || precioNumerico <= 0) {
                    return null;
                }
                
                const precioEnCLP = precioNumerico * valorUF;
                const rentabilidad = (arriendoAnual / precioEnCLP) * 100;
                
                return rentabilidad;
                
            } catch (error) {
                console.error('Error calculando rentabilidad:', error);
                return null;
            }
        }

        function parseCSVRow(csvRow) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < csvRow.length; i++) {
                const char = csvRow[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        function generateFilters(properties) {
            console.log('üéõÔ∏è Generando filtros din√°micos...');
            
            // Generar rangos de bonos
            const bonos = properties
                .map(p => p.bono || 0)
                .filter(b => b > 0)
                .sort((a, b) => a - b);
                
            if (bonos.length > 0) {
                const bonoRanges = generateRanges(bonos, 'bono');
                populateSelect('filterBono', bonoRanges);
            }
            
            // Generar rangos de precios
            const precios = properties
                .map(p => p.precio || 0)
                .filter(p => p > 0)
                .sort((a, b) => a - b);
                
            if (precios.length > 0) {
                const precioRanges = generateRanges(precios, 'precio');
                populateSelect('filterPrecio', precioRanges);
            }
            
            // Generar opciones de ubicaci√≥n
            const ubicaciones = [...new Set(properties
                .map(p => p.allData?.D)
                .filter(u => u && u.trim())
                .map(u => u.trim())
            )].sort();
            
            populateSelectOptions('filterUbicacion', ubicaciones);
            
            // Generar opciones de tipolog√≠a
            const tipologias = [...new Set(properties
                .map(p => p.allData?.G)
                .filter(t => t && t.trim())
                .map(t => t.trim())
            )].sort();
            
            populateSelectOptions('filterTipologia', tipologias);
            
            console.log('‚úÖ Filtros generados correctamente');
        }

        function generateRanges(values, type) {
            if (values.length === 0) return [];
            
            const min = values[0];
            const max = values[values.length - 1];
            const ranges = [];
            
            if (type === 'bono') {
                ranges.push({ label: 'Sin bono (0)', value: '0-0' });
                
                const step = Math.ceil((max - min) / 5);
                let current = min;
                
                while (current < max) {
                    const rangeEnd = Math.min(current + step, max);
                    ranges.push({
                        label: `$${current.toLocaleString()} - $${rangeEnd.toLocaleString()}`,
                        value: `${current}-${rangeEnd}`
                    });
                    current = rangeEnd + 1;
                }
            } else if (type === 'precio') {
                const step = Math.ceil((max - min) / 6);
                let current = min;
                
                while (current < max) {
                    const rangeEnd = Math.min(current + step, max);
                    ranges.push({
                        label: `${current.toLocaleString()} - ${rangeEnd.toLocaleString()} UF`,
                        value: `${current}-${rangeEnd}`
                    });
                    current = rangeEnd + 1;
                }
            }
            
            return ranges;
        }

        function populateSelect(selectId, ranges) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            // Mantener la opci√≥n por defecto
            const defaultOption = select.children[0];
            select.innerHTML = '';
            select.appendChild(defaultOption);
            
            ranges.forEach(range => {
                const option = document.createElement('option');
                option.value = range.value;
                option.textContent = range.label;
                select.appendChild(option);
            });
        }

        function populateSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            // Mantener la opci√≥n por defecto
            const defaultOption = select.children[0];
            select.innerHTML = '';
            select.appendChild(defaultOption);
            
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
        }

        function applyFilters() {
            const filters = getFilterValues();
            
            filteredProperties = propsData.filter(property => {
                // Filtro de bono
                const bono = Number(property.bono) || 0;
                if (filters.bonoMin === 0 && filters.bonoMax === 0) {
                    if (bono !== 0) return false;
                } else {
                    if (bono < filters.bonoMin || bono > filters.bonoMax) return false;
                }
                
                // Filtro de precio
                const precio = Number(property.precio) || 0;
                if (precio < filters.precioMin || precio > filters.precioMax) return false;
                
                // Filtro de ubicaci√≥n
                if (filters.ubicacion) {
                    const comuna = property.allData?.D?.toString().trim() || '';
                    if (!comuna.toLowerCase().includes(filters.ubicacion.toLowerCase())) return false;
                }
                
                // Filtro de tipolog√≠a
                if (filters.tipologia) {
                    const tipologia = property.allData?.G?.toString().trim() || '';
                    if (!tipologia.toLowerCase().includes(filters.tipologia.toLowerCase())) return false;
                }
                
                return true;
            });
            
            displayProperties(filteredProperties);
            updatePropertiesCount(filteredProperties.length);
        }

        function getFilterValues() {
            const filters = {
                bonoMin: 0,
                bonoMax: Infinity,
                precioMin: 0,
                precioMax: Infinity,
                ubicacion: '',
                tipologia: ''
            };
            
            // Filtros de bono
            if (isBonoManualMode) {
                const minVal = document.getElementById('filterBonoMin').value;
                const maxVal = document.getElementById('filterBonoMax').value;
                filters.bonoMin = minVal ? parseFloat(minVal.replace(/,/g, '')) : 0;
                filters.bonoMax = maxVal ? parseFloat(maxVal.replace(/,/g, '')) : Infinity;
            } else {
                const bonoRange = document.getElementById('filterBono').value;
                if (bonoRange) {
                    const [min, max] = bonoRange.split('-').map(Number);
                    filters.bonoMin = min;
                    filters.bonoMax = max;
                }
            }
            
            // Filtros de precio
            if (isPrecioManualMode) {
                const minVal = document.getElementById('filterPrecioMin').value;
                const maxVal = document.getElementById('filterPrecioMax').value;
                filters.precioMin = minVal ? parseFloat(minVal.replace(/,/g, '')) : 0;
                filters.precioMax = maxVal ? parseFloat(maxVal.replace(/,/g, '')) : Infinity;
            } else {
                const precioRange = document.getElementById('filterPrecio').value;
                if (precioRange) {
                    const [min, max] = precioRange.split('-').map(Number);
                    filters.precioMin = min;
                    filters.precioMax = max;
                }
            }
            
            // Otros filtros
            filters.ubicacion = document.getElementById('filterUbicacion').value;
            filters.tipologia = document.getElementById('filterTipologia').value;
            
            return filters;
        }

        function displayProperties(properties) {
            const gridEl = document.getElementById('properties-grid');
            gridEl.innerHTML = '';
            
            if (properties.length === 0) {
                gridEl.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üè†</div>
                        <h3 style="font-size: 2rem; margin-bottom: 16px;">No se encontraron propiedades</h3>
                        <p style="font-size: 1.2rem; margin-bottom: 32px;">Intenta ajustar los filtros para ver m√°s resultados</p>
                        <button class="action-btn" onclick="clearAllFilters()">üîÑ Limpiar Filtros</button>
                    </div>
                `;
                return;
            }
            
            properties.forEach((property, index) => {
                const card = createPropertyCard(property, index);
                gridEl.appendChild(card);
            });
        }

        function createPropertyCard(property, index) {
            const card = document.createElement('div');
            card.className = 'property-card';
            card.style.animationDelay = `${index * 0.1}s`;
            
            const precioUF = Math.round(property.precio || 0);
            const precioCLP = precioUF * valorUF;
            const cardId = `${property.codigo}-${index}`;
            
            // Determinar informaci√≥n de bono
            const bono = property.bono || 0;
            const bonoHtml = bono > 0 
                ? `<div class="bono-badge">üéÅ Bono: $${Math.round(bono).toLocaleString()}</div>`
                : '<div class="bono-badge" style="background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.6);">Sin bono disponible</div>';
            
            // Determinar rentabilidad
            const rentabilidad = property.allData?.AJ ? parseFloat(property.allData.AJ) : null;
            let rentabilidadHtml = '';
            
            if (rentabilidad && rentabilidad > 0) {
                let rentabilidadClass = 'rentabilidad-low';
                let rentabilidadIcon = 'üìâ';
                let rentabilidadText = 'BAJA';
                
                if (rentabilidad >= 5) {
                    rentabilidadClass = 'rentabilidad-good';
                    rentabilidadIcon = 'üìà';
                    rentabilidadText = 'EXCELENTE';
                } else if (rentabilidad >= 3) {
                    rentabilidadClass = 'rentabilidad-average';
                    rentabilidadIcon = 'üìä';
                    rentabilidadText = 'BUENA';
                }
                
                rentabilidadHtml = `
                    <div class="rentabilidad-indicator ${rentabilidadClass}">
                        <div class="rentabilidad-label">
                            ${rentabilidadIcon} RENTABILIDAD ${rentabilidadText}
                        </div>
                        <div class="rentabilidad-value">
                            <strong>${rentabilidad.toFixed(1)}%</strong>
                        </div>
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="property-code" onclick="copyToClipboard('${property.codigo}')" title="Clic para copiar">
                        ${property.codigo}
                    </div>
                    <div class="property-price" id="price-${cardId}" data-showing="uf" onclick="togglePrecio('${cardId}', ${precioUF})">
                        ${precioUF.toLocaleString()} UF
                    </div>
                    <div class="price-label" id="price-label-${cardId}">
                        üí∞ Precio ‚Ä¢ Clic para cambiar moneda
                    </div>
                </div>
                
                <div class="card-content">
                    ${bonoHtml}
                    ${rentabilidadHtml}
                    
                    <div class="property-info">
                        <div class="info-row">
                            <span class="info-label">üìç Comuna</span>
                            <span class="info-value">${property.allData?.D || 'No especificada'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">üè¢ Tipolog√≠a</span>
                            <span class="info-value">${property.allData?.G || 'No especificada'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">üõèÔ∏è Dormitorios</span>
                            <span class="info-value">${property.allData?.H || 'N/D'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">üöø Ba√±os</span>
                            <span class="info-value">${property.allData?.I || 'N/D'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">üìê M¬≤ √ötiles</span>
                            <span class="info-value">${property.allData?.L || 'N/D'}</span>
                        </div>
                    </div>
                    
                    <div class="card-actions">
                        <button class="btn-primary" onclick="showPropertyModal('${property.codigo}')">
                            üìã Ver Detalles Completos
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        function togglePrecio(cardId, precioUF) {
            const priceEl = document.getElementById(`price-${cardId}`);
            const labelEl = document.getElementById(`price-label-${cardId}`);
            const isShowingUF = priceEl.dataset.showing === 'uf';
            
            if (isShowingUF) {
                const precioCLP = precioUF * valorUF;
                priceEl.textContent = `$${Math.round(precioCLP).toLocaleString()}`;
                priceEl.dataset.showing = 'clp';
                labelEl.textContent = 'üíµ Precio CLP ‚Ä¢ Clic para UF';
            } else {
                priceEl.textContent = `${precioUF.toLocaleString()} UF`;
                priceEl.dataset.showing = 'uf';
                labelEl.textContent = 'üí∞ Precio UF ‚Ä¢ Clic para CLP';
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Mostrar feedback visual
                const event = new CustomEvent('show-toast', {
                    detail: { message: `C√≥digo ${text} copiado al portapapeles` }
                });
                window.dispatchEvent(event);
            });
        }

        function showPropertyModal(codigo) {
            const property = propsData.find(p => p.codigo === codigo);
            if (!property) return;
            
            const modal = document.getElementById('propertyModal');
            const content = document.getElementById('propertyDetails');
            
            const columnNames = {
                'A': 'OP', 'B': 'CONDOMINIO', 'C': 'DIRECCI√ìN', 'D': 'COMUNA', 'E': 'DP',
                'F': 'REGI√ìN', 'G': 'TIPOLOG√çA', 'H': 'DORMITORIOS', 'I': 'BA√ëOS',
                'J': 'ESTACIONAMIENTOS', 'K': 'BODEGAS', 'L': 'M¬≤ √öTILES', 'M': 'M¬≤ TERRAZA',
                'N': 'M¬≤ TOTALES', 'O': 'PISO', 'P': 'ORIENTACI√ìN', 'Q': 'VISTA',
                'R': 'ENTREGA', 'S': 'CANON ARRIENDO', 'T': 'GASTOS COMUNES',
                'U': 'CONTRIBUCIONES', 'V': 'SEGUROS', 'W': 'OTROS GASTOS',
                'X': 'GASTOS TOTALES', 'Y': 'FLUJO LIBRE', 'Z': 'VENDEDOR',
                'AA': 'COMISI√ìN VENDEDOR', 'AB': 'COMISI√ìN CLIENTE', 'AC': 'PIE M√çNIMO UF',
                'AD': 'PIE M√çNIMO %', 'AE': 'PRECIO LISTA UF', 'AF': 'PRECIO LISTA CLP',
                'AI': 'ARRIENDO BRUTO ANUAL', 'AJ': 'RENTABILIDAD BRUTA (ANUAL)', 'AK': 'LINK PUBLICACI√ìN'
            };
            
            let detailsHtml = `
                <div class="text-center mb-4">
                    <div class="brand-icon" style="width: 60px; height: 60px; margin: 0 auto 16px;">üè†</div>
                    <h2 style="font-size: 2rem; margin-bottom: 8px;">Propiedad ${property.codigo}</h2>
                    <p style="color: rgba(255,255,255,0.7);">Informaci√≥n detallada completa</p>
                </div>
                
                <div style="display: grid; gap: 16px;">
            `;
            
            Object.entries(columnNames).forEach(([column, name]) => {
                const value = property.allData[column];
                if (value && value.toString().trim()) {
                    let displayValue = value.toString();
                    
                    // Formatear URLs como enlaces
                    if (displayValue.startsWith('http')) {
                        displayValue = `<a href="${displayValue}" target="_blank" style="color: #FF6B6B; text-decoration: none;">üîó Ver enlace</a>`;
                    }
                    
                    detailsHtml += `
                        <div class="info-row">
                            <span class="info-label">${name}:</span>
                            <span class="info-value">${displayValue}</span>
                        </div>
                    `;
                }
            });
            
            detailsHtml += '</div>';
            content.innerHTML = detailsHtml;
            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('propertyModal').style.display = 'none';
        }

        function updatePropertiesCount(count) {
            const countEl = document.getElementById('properties-count');
            countEl.textContent = `${count} ${count === 1 ? 'propiedad' : 'propiedades'}`;
        }

        // Funciones de filtros
        function toggleBonoFilterType() {
            isBonoManualMode = !isBonoManualMode;
            const rangeFilter = document.getElementById('bonoRangeFilter');
            const manualFilter = document.getElementById('bonoManualFilter');
            const toggleBtn = document.getElementById('toggleBonoFilter');
            
            if (isBonoManualMode) {
                rangeFilter.style.display = 'none';
                manualFilter.style.display = 'block';
                toggleBtn.textContent = 'üìä Cambiar a Rangos';
                toggleBtn.classList.remove('active');
            } else {
                rangeFilter.style.display = 'block';
                manualFilter.style.display = 'none';
                toggleBtn.textContent = '‚öôÔ∏è Cambiar a Manual';
                toggleBtn.classList.add('active');
            }
        }

        function togglePrecioFilterType() {
            isPrecioManualMode = !isPrecioManualMode;
            const rangeFilter = document.getElementById('precioRangeFilter');
            const manualFilter = document.getElementById('precioManualFilter');
            const toggleBtn = document.getElementById('togglePrecioFilter');
            
            if (isPrecioManualMode) {
                rangeFilter.style.display = 'none';
                manualFilter.style.display = 'block';
                toggleBtn.textContent = 'üìä Cambiar a Rangos';
                toggleBtn.classList.remove('active');
            } else {
                rangeFilter.style.display = 'block';
                manualFilter.style.display = 'none';
                toggleBtn.textContent = '‚öôÔ∏è Cambiar a Manual';
                toggleBtn.classList.add('active');
            }
        }

        function clearAllFilters() {
            // Resetear filtros
            document.getElementById('filterBono').value = '';
            document.getElementById('filterPrecio').value = '';
            document.getElementById('filterUbicacion').value = '';
            document.getElementById('filterTipologia').value = '';
            document.getElementById('filterBonoMin').value = '';
            document.getElementById('filterBonoMax').value = '';
            document.getElementById('filterPrecioMin').value = '';
            document.getElementById('filterPrecioMax').value = '';
            
            // Aplicar filtros
            applyFilters();
        }

        // Funciones para condiciones
        async function loadCondiciones() {
            console.log('üìã Cargando condiciones desde Google Sheets...');
            
            try {
                const condicionesUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${CONDICIONES_GID}`;
                const response = await fetch(condicionesUrl);
                
                if (!response.ok) {
                    throw new Error('Error al cargar condiciones');
                }
                
                const text = await response.text();
                const lines = text.split('\n').filter(line => line.trim());
                
                let content = '<div style="line-height: 1.8; font-size: 1.1rem;">';
                
                lines.forEach((line, index) => {
                    const cleanLine = line.replace(/"/g, '').trim();
                    if (cleanLine) {
                        if (index === 0) {
                            content += `<h2 style="color: #FF6B6B; margin-bottom: 24px; text-align: center;">${cleanLine}</h2>`;
                        } else {
                            content += `<p style="margin-bottom: 16px; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">${cleanLine}</p>`;
                        }
                    }
                });
                
                content += '</div>';
                return content;
                
            } catch (error) {
                console.error('‚ùå Error cargando condiciones:', error);
                return `
                    <div style="text-align: center; line-height: 1.8;">
                        <h2 style="color: #FF6B6B; margin-bottom: 24px;">T√©rminos y Condiciones - TuMatch Inmobiliario</h2>
                        <p><strong>TuMatch Inmobiliario</strong> es una plataforma digital que facilita la b√∫squeda de propiedades inmobiliarias con bonos disponibles.</p>
                        <p style="margin-top: 32px; padding-top: 24px; border-top: 1px solid rgba(255,255,255,0.2);">Al utilizar esta plataforma, usted <strong>reconoce haber le√≠do</strong> y acepta estos t√©rminos y condiciones.</p>
                    </div>
                `;
            }
        }

        function showCondicionesModal() {
            const modal = document.getElementById('condicionesModal');
            const content = document.getElementById('condicionesContent');
            
            modal.style.display = 'flex';
            
            loadCondiciones().then(html => {
                content.innerHTML = html;
            });
        }

        function closeCondicionesModal() {
            document.getElementById('condicionesModal').style.display = 'none';
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Iniciando aplicaci√≥n TuMatch Inmobiliario...');
            
            try {
                // Cargar valor UF
                await obtenerValorUF();
                
                // Cargar datos
                const sheetsData = await loadSheetData();
                propsData = sheetsData.propsData;
                bonosData = sheetsData.bonosData;
                
                // Procesar datos
                const properties = parseCSVData();
                propsData = properties;
                filteredProperties = [...properties];
                
                // Generar filtros
                generateFilters(properties);
                
                // Mostrar propiedades
                displayProperties(filteredProperties);
                updatePropertiesCount(filteredProperties.length);
                
                // Configurar listeners de filtros
                setupFilterListeners();
                
                // Mostrar contenido
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').classList.remove('hidden');
                
                console.log('‚úÖ Aplicaci√≥n iniciada correctamente');
                
            } catch (error) {
                console.error('‚ùå Error iniciando aplicaci√≥n:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <h3>Error cargando datos</h3>
                        <p>No se pudieron cargar las propiedades. Por favor, recarga la p√°gina.</p>
                        <button class="action-btn" onclick="location.reload()">üîÑ Recargar</button>
                    </div>
                `;
            }
        });

        function setupFilterListeners() {
            const filterElements = [
                'filterBono', 'filterPrecio', 'filterUbicacion', 'filterTipologia',
                'filterBonoMin', 'filterBonoMax', 'filterPrecioMin', 'filterPrecioMax'
            ];
            
            filterElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', applyFilters);
                    element.addEventListener('input', applyFilters);
                }
            });
        }

        // Cerrar modales al hacer clic fuera
        document.addEventListener('click', (e) => {
            const modals = ['propertyModal', 'condicionesModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Toast notifications
        window.addEventListener('show-toast', (e) => {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #FF6B6B, #FF1493);
                color: white;
                padding: 16px 24px;
                border-radius: 16px;
                box-shadow: 0 12px 32px rgba(255, 107, 107, 0.3);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = e.detail.message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        });
    </script>
    
    <style>
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</body>
</html>